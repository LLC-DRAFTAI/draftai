# Dockerfile.bim
FROM python:3.13-slim

ENV PYTHONUNBUFFERED=1 LANG=C.UTF-8 LC_ALL=C.UTF-8

RUN apt-get update && apt-get install -y --no-install-recommends \
    build-essential gcc g++ git wget ca-certificates \
    libxml2-dev libxslt1-dev zlib1g-dev libffi-dev \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app

COPY nlp_core/requirements.txt /app/requirements.txt
RUN pip install --upgrade pip setuptools wheel \
 && pip install --no-cache-dir -r /app/requirements.txt

COPY bim_core/ /app/bim_core/

RUN useradd -m appuser
USER appuser
WORKDIR /home/appuser

CMD ["python", "/app/bim_core/bim_core/run_cli.py", "--tz", "/app/nlp_core/OUT/result.json", "--out", "/app/bim_core/runs"]
