# MCP Server (FreeCAD)

**MCP Server** ‚Äî –ª—ë–≥–∫–∏–π TCP-—Å–µ—Ä–≤–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `stubs.json` (—Å–ø–∏—Å–æ–∫ –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤) –∏ —Ä–∞–∑–º–µ—â–∞–µ—Ç –ø—Ä–∏–º–∏—Ç–∏–≤—ã (—Ä–∞–¥–∏–∞—Ç–æ—Ä—ã) –≤ –∞–∫—Ç–∏–≤–Ω–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ FreeCAD.  
–ü—Ä–æ–µ–∫—Ç –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É: MCP –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ FreeCAD (GUI) –∏–ª–∏ —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º–Ω—ã–π Python –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º FreeCAD (–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è `FREECAD_PATH`).

> –í–∞–∂–Ω–æ: –º–æ–¥—É–ª–∏ `FreeCAD`/`Part` –¥–æ—Å—Ç—É–ø–Ω—ã **—Ç–æ–ª—å–∫–æ** –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–∏ FreeCAD –∏–ª–∏ –µ—Å–ª–∏ –≤—ã —É–∫–∞–∑–∞–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –ø–∞–ø–∫—É —Å –±–∏–Ω–∞—Ä–Ω—ã–º–∏ –º–æ–¥—É–ª—è–º–∏ —á–µ—Ä–µ–∑ `FREECAD_PATH`. MCP –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ CI (GitHub Actions) –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî FreeCAD —Ç–∞–º –Ω–µ—Ç.

---

üìÇ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞**

```
mcp_server/
‚îú‚îÄ‚îÄ mcp_serverV3.py        # –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ —Å–µ—Ä–≤–µ—Ä–∞ (–±–µ–∑–æ–ø–∞—Å–µ–Ω –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –±–µ–∑ FreeCAD)
‚îú‚îÄ‚îÄ run_cli.py             # CLI-wrapper –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∏–∑ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ Python
‚îî‚îÄ‚îÄ README.md              # –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –º–æ–¥—É–ª—è
```

---

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**

- Python `>= 3.11` (–¥–ª—è –∑–∞–ø—É—Å–∫–∞ wrapper –∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö —É—Ç–∏–ª–∏—Ç).  
- –î–ª—è —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤ ‚Äî –ª–æ–∫–∞–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π **FreeCAD** (GUI –∏–ª–∏ FreeCAD Python).  
- –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º–Ω—ã–π `python` —É–∫–∞–∂–∏—Ç–µ `FREECAD_PATH`, —É–∫–∞–∑—ã–≤–∞—é—â—É—é –Ω–∞ –ø–∞–ø–∫—É —Å `FreeCAD.pyd`/–±–∏–Ω–∞—Ä–Ω—ã–º–∏ –º–æ–¥—É–ª—è–º–∏ (–ø—Ä–∏–º–µ—Ä: `C:\Program Files\FreeCAD 0.21\bin`).

---

‚öôÔ∏è **–£—Å—Ç–∞–Ω–æ–≤–∫–∞**

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞.  
2. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –¥–ª—è —É—Ç–∏–ª–∏—Ç/—Å–∫—Ä–∏–ø—Ç–æ–≤ `scripts/`:
```powershell
python -m venv .venv
.\.venv\Scripts\Activate.ps1   # PowerShell
pip install --upgrade pip
# –∑–∞—Ç–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–ª—è nlp/bim –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
```

> MCP —Å–∞–º –ø–æ —Å–µ–±–µ –Ω–µ –∏–º–µ–µ—Ç –≤–Ω–µ—à–Ω–∏—Ö pip-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∫—Ä–æ–º–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫, –Ω–æ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ pipeline –Ω—É–∂–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ NLP/BIM.

---

**–°—Ü–µ–Ω–∞—Ä–∏–∏ –∑–∞–ø—É—Å–∫–∞**

1) –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ –≤–Ω—É—Ç—Ä–∏ FreeCAD (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞)

–û—Ç–∫—Ä–æ–π—Ç–µ FreeCAD GUI ‚Üí *Python Console* –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```python
exec(open(r"C:\path\to\draftai\mcp_server\mcp_serverV3.py", encoding="utf-8").read())
```

–ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–∞–∫ `__main__` –º–æ–¥—É–ª—å –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è:
- –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç (–µ—Å–ª–∏ ActiveDocument == None);
- –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä –≤ —Ñ–æ–Ω–æ–≤–æ–º –ø–æ—Ç–æ–∫–µ (`run_in_background()`), —á—Ç–æ–±—ã GUI –æ—Å—Ç–∞–ª—Å—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º.

–ï—Å–ª–∏ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–æ—à—ë–ª —É—Å–ø–µ—à–Ω–æ ‚Äî –≤ Python Console/Report View –ø–æ—è–≤—è—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞.

---

**–û–ø—Ü–∏–∏ `run_cli.py`:**
- `--host` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `127.0.0.1`) ‚Äî —Ö–æ—Å—Ç –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏.  
- `--port` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `9090`) ‚Äî TCP-–ø–æ—Ä—Ç.  
- `--background` / `-b` ‚Äî –∑–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–µ (daemon thread).  
- `--freecad-path` ‚Äî –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ FreeCAD bin (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).  
- `--verbose` / `-v` ‚Äî –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏.

---

**–û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤ `stubs.json` (–∫–ª–∏–µ–Ω—Ç)**

–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ BIM —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–ª `stubs.json` (–≤ `bim_core/runs/.../stubs.json`), –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –µ–≥–æ –Ω–∞ MCP:

```powershell
python .\scripts\send_stubs_cli.py --stubs bim_core/runs/stubs.json -v

```

–ö–ª–∏–µ–Ω—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—Å—è –∫ MCP –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç JSON (–æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ + `\n`). –í –∞–∫—Ç–∏–≤–Ω–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ FreeCAD –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –æ–±—ä–µ–∫—Ç—ã.

---

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ –∫–æ–¥–∞ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞ –≤ CI**

- `mcp_serverV3.py` –Ω–∞–ø–∏—Å–∞–Ω —Ç–∞–∫, —á—Ç–æ–±—ã **–±–µ–∑–æ–ø–∞—Å–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –±–µ–∑ FreeCAD**: –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ FreeCAD –º–æ–¥—É–ª—å –Ω–µ –ø–∞–¥–∞–µ—Ç, –∞ –ª–æ–≥–∏—Ä—É–µ—Ç –ø–æ–¥—Å–∫–∞–∑–∫–∏. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å CI (–ª–∏–Ω–µ—Ä—ã, —Ç–µ—Å—Ç—ã NLP/BIM) –±–µ–∑ –æ—à–∏–±–æ–∫.  
- –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ `__main__` (–≤—ã–∑–æ–≤ `exec(...)` –≤ FreeCAD) ‚Äî —É–¥–æ–±–Ω–∞—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è —Ñ–∏—á–∞; –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –≤ wrapper (`run_cli.py`) –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç (—á—Ç–æ–±—ã CI/–∏–º–ø–æ—Ä—Ç –Ω–µ —Å—Ç–∞—Ä—Ç–æ–≤–∞–ª —Å–µ—Ä–≤–µ—Ä).  
- –í CI **–Ω–µ** –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è —à–∞–≥–∏, —Ç—Ä–µ–±—É—é—â–∏–µ FreeCAD. –î–ª—è –ø–æ–∫—Ä—ã—Ç–∏–π, –∑–∞–≤–∏—Å—è—â–∏—Ö –æ—Ç MCP, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–æ–∫–∏ `FreeCAD`/`Part` –≤ —Ç–µ—Å—Ç–∞—Ö.

---

**–õ–æ–≥–∏ –∏ –≤–∏–¥–∏–º–æ—Å—Ç—å –≤ FreeCAD**

- –î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `mcp_serverV3.py` –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π `logging`. –ú—ã —Ç–∞–∫–∂–µ –¥–æ–±–∞–≤–∏–ª–∏ `FreeCAD`-–ª–æ–≥-—Ö–µ–Ω–¥–ª–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ `FreeCAD` –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç `logging` –≤ Report View / Python Console (`FreeCAD.Console.PrintMessage` / `PrintError`).  
- –ï—Å–ª–∏ –≤—ã –Ω–µ –≤–∏–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Report View, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã:
  - –≤—ã–ø–æ–ª–Ω–∏–ª–∏ `exec(...)` –≤–Ω—É—Ç—Ä–∏ FreeCAD (–∏–ª–∏ –ø–æ–¥–∫–ª—é—á–∏–ª–∏ `run_cli.py` —Å `--freecad-path`),  
  - Report View –æ—Ç–∫—Ä—ã—Ç (View ‚Üí Panels ‚Üí Report view).  

---

**Troubleshooting (—á–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏)**

- **`ModuleNotFoundError: No module named 'FreeCAD'`**  
  ‚Äî –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –≤–Ω—É—Ç—Ä–∏ FreeCAD (exec) –∏–ª–∏ —É–∫–∞–∂–∏—Ç–µ `FREECAD_PATH` –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º `run_cli.py`.

- **`ConnectionRefusedError` –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ stubs**  
  ‚Äî MCP –Ω–µ —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∑–∞–ø—É—â–µ–Ω –ª–∏ MCP (FreeCAD console / run_cli logs), –∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç –ª–∏ host/port —É –∫–ª–∏–µ–Ω—Ç–∞ –∏ —Å–µ—Ä–≤–µ—Ä–∞.

- **–õ–æ–≥–∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ Report View**  
  ‚Äî –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `attach_freecad_logging()` –≤—ã–∑–≤–∞–Ω (–≤ `mcp_serverV3.py` –æ–Ω –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ `FreeCAD`) –∏ Report View –æ—Ç–∫—Ä—ã—Ç.

---

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Pipeline**

- –í `scripts/run_pipeline_local.*` –ª–æ–≥–∏–∫–∞ pipeline —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç `stubs.json` (NLP ‚Üí BIM), –∑–∞—Ç–µ–º –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç/–∂–¥—ë—Ç –∑–∞–ø—É—Å–∫–∞ MCP –≤ FreeCAD, –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `stubs.json` —á–µ—Ä–µ–∑ `send_stubs_cli.py`. –≠—Ç–æ –∫–æ–º–±–∏–Ω–∞—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –∏ —Ä—É—á–Ω–æ–≥–æ —à–∞–≥–∞, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–≥–æ –∏–∑-–∑–∞ GUI-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ FreeCAD.

---

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**

- –õ–æ–∫–∞–ª—å–Ω–æ: –æ—Ç–∫—Ä–æ–π—Ç–µ FreeCAD, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `exec(...)` –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `run_cli.py`, –∑–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ `send_stubs_cli.py` –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –æ–±—ä–µ–∫—Ç—ã –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ.  
- –í CI: —Ç–µ—Å—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä–µ–±—É—é—Ç —Ä–∞–±–æ—Ç—ã —Å `FreeCAD` –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–ø—É—Å–∫–∞—Ç—å —Å –º–æ–∫–∞–º–∏; —Å–µ—Ç–µ–≤–æ–π –∫–ª–∏–µ–Ω—Ç/—Å–µ—Ä–≤–µ—Ä –º–æ–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ —Å –ø—Ä–æ—Å—Ç—ã–º TCP-—ç—Ö–æ-—Å–µ—Ä–≤–µ—Ä–æ–º.

---

